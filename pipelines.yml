resources:
  - name: sample_resource_violation
    type: GitRepo
    configuration:
      gitProvider: github_jprinet
      path: jprinet/jfrog-pipelines-sample
      branches:
        include: feature/add_xray_violation
  - name: myBuildInfoViolation
    type: BuildInfo
    configuration:
      sourceArtifactory:    artifactory_jerome
      buildName:            sample_pipelines_violation
      buildNumber:          ${run_number}
      externalCI:           jenkinsIntegration
  - name: myBuildInfoViolationPromoted
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_jerome
      buildName: sample_pipelines_violation
      buildNumber: '${run_number}'

pipelines:
  - name: sample_pipelines_violation

    steps:
      - name: build_native
        type: GradleBuild
        configuration:
          runtime:
            type: image
            image:
              custom:
                name: jprinet/jfrog-pipelines-runner
                tag: latest
          gradleCommand:        clean artifactoryPublish
          sourceLocation:       .
          configFileLocation:   .jfrog/projects
          configFileName:       gradle.yaml
          forceXrayScan:        true
          failOnScan:           true
          autoPublishBuildInfo: true
          inputResources:
            - name: sample_resource_violation
          outputResources:
            - name: myBuildInfoViolation
          integrations:
            - name: artifactory_jerome
        execution:
          onStart:
            - java -version
            - jfrog -v

      - name: promote
        type: PromoteBuild
        configuration:
          targetRepository:      jerome-mvn-int-local
          includeDependencies:   true
          status:                'DEV OK'
          comment:               'passed DEV pipeline'
          copy:                  false
          inputResources:
            - name:         myBuildInfoViolation
              trigger: false
          inputSteps:
            - name: build_native
          outputResources:
            - name:         myBuildInfoViolationPromoted
